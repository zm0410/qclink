<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="description" content="ç®€æ´ç¾è§‚çš„é™æ€å¯¼èˆªç«™ï¼Œæ”¯æŒå¤šçº§åˆ†ç±»ã€å¤œé—´æ¨¡å¼ï¼Œçº¯å‰ç«¯æ‰˜ç®¡å³å¯ä½¿ç”¨ã€‚"/>
  <meta name="keywords" content="å¯¼èˆª,é™æ€ç«™,å¤šçº§åˆ†ç±»,å¤œé—´æ¨¡å¼,SEOå‹å¥½"/>
  <title>é™æ€å¯¼èˆªç«™ - å¤šçº§åˆ†ç±»Â·å¤œé—´æ¨¡å¼</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
<header>
  <h1>é™æ€å¯¼èˆªç«™</h1>
  <button id="themeBtn" aria-label="åˆ‡æ¢å¤œé—´æ¨¡å¼">ğŸŒ™</button>
</header>

<main>
  <nav id="side"></nav>
  <section>
    <h2 id="subTitle">è¯·é€‰æ‹©åˆ†ç±»</h2>
    <div id="list"></div>
  </section>
</main>

<script>
/* ===== å¤œé—´æ¨¡å¼ ===== */
const themeBtn = document.getElementById('themeBtn');
const body = document.body;

// åˆå§‹åŒ–
if (localStorage.getItem('theme') === 'dark') {
  body.classList.add('dark');
  themeBtn.textContent = 'â˜€ï¸';
}

themeBtn.addEventListener('click', () => {
  body.classList.toggle('dark');
  const isDark = body.classList.contains('dark');
  localStorage.setItem('theme', isDark ? 'dark' : '');
  themeBtn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
});

/* ===== é€’å½’æ ‘ï¼ˆæ— ç®­å¤´ï¼‰ ===== */
function buildTree(arr, parentKey = '', pathNames = [], level = 0) {
  let html = '';
  arr.forEach((node, idx) => {
    const key = parentKey ? `${parentKey}-${idx}` : `${idx}`;
    const curNames = [...pathNames, node.name];
    const hasSub = node.children && node.children.length;
    const hasSites = node.sites && node.sites.length;

    html += `
      <div class="nav-item">
        <div class="nav-row"
             data-level="${level}"
             data-key="${key}"
             data-name="${node.name}"
             data-container="${hasSub ? 'children' : 'sites'}"
             ${hasSites ? `data-sites='${JSON.stringify(node.sites)}' data-path="${curNames.join('-')}"` : ''}>
          <span class="nav-icon">ğŸ“</span>
          <span>${node.name}</span>
        </div>`;

    if (hasSub) {
      html += `<div class="nav-children" data-parent="${key}">
                 ${buildTree(node.children, key, curNames, level + 1)}
               </div>`;
    }
    html += `</div>`;
  });
  return html;
}

/* ===== å³ä¾§åˆ—è¡¨ ===== */
function showSites(title, sites) {
  document.getElementById('subTitle').textContent = title;
  const box = document.getElementById('list');
  if (!sites.length) { box.innerHTML = '<p style="color:#999">æš‚æ— ç«™ç‚¹</p>'; return; }
  box.innerHTML = sites.map(s => `
    <a class="site-row" href="${s.url}" target="_blank" rel="noopener">
      <span class="site-icon">${s.icon || 'ğŸŒ'}</span>
      <div class="site-info">
        <div class="site-name">${s.name}</div>
        <div class="site-desc">${s.desc || ''}</div>
      </div>
      <span class="site-url">${s.url}</span>
    </a>`).join('');
}

/* ===== å…¥å£ ===== */
fetch('data.json')
  .then(r => r.json())
  .then(data => {
    document.getElementById('side').innerHTML = buildTree(data);

    document.getElementById('side').addEventListener('click', e => {
      const row = e.target.closest('.nav-row');
      if (!row) return;

      /* æŠ˜å /å±•å¼€ï¼ˆç‚¹å‡»æ–‡ä»¶å¤¹åï¼‰ */
      const children = row.nextElementSibling;
      if (children && children.classList.contains('nav-children')) {
        children.classList.toggle('open');
      }

      /* é€‰ä¸­å¹¶å±•ç¤ºå³ä¾§ */
      document.querySelectorAll('.nav-row').forEach(r => r.classList.remove('active'));
      row.classList.add('active');
      const sites = JSON.parse(row.dataset.sites || '[]');
      showSites(row.dataset.name, sites);
    });
  });
</script>
</body>
</html>
